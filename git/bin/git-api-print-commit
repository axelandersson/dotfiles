#!/usr/bin/perl -w

use strict;
use CLI;
use CLI::Git;

my $options = CLI::options("short", "long");
my $commit = shift @ARGV;

CLI::usage("--short|--long <commit>") if $options->{"help"} || (!$options->{"short"} && !$options->{"long"}) || !CLI::Git::iscommit($commit);

my $pager = CLI::Git::pager();
my @flags;

if($options->{"short"}) {
    push(@flags, "--stat");
} else {
    push(@flags, "--patch");
}

my $input = CLI::Git::show_commit($commit, \@flags);
my @output;

push(@output, CLI::justifiedstring("Author: ", -12) . CLI::Git::authorstring($input->{"author"}) . " " . CLI::Git::emailstring($input->{"author-email"}));
push(@output, CLI::justifiedstring("Date: ", -12) . CLI::Git::datestring($input->{"author-date"}));
push(@output, CLI::justifiedstring("Committer: ", -12) . CLI::Git::authorstring($input->{"committer"}) . " " . CLI::Git::emailstring($input->{"committer-email"}));
push(@output, CLI::justifiedstring("Date: ", -12) . CLI::Git::datestring($input->{"committer-date"}));
push(@output, CLI::justifiedstring("Refs: ", -12) . $input->{"refs"});
push(@output, CLI::justifiedstring("Commit: ", -12) . CLI::Git::commitstring($input->{"commit"}));
push(@output, CLI::justifiedstring("Parents: ", -12) . CLI::Git::commitstring($input->{"parents"}));
push(@output, CLI::justifiedstring("Tree: ", -12) . CLI::Git::commitstring($input->{"tree"}));
push(@output, CLI::justifiedstring("Subject: ", -12) . CLI::Git::subjectstring($input->{"subject"}));

foreach my $line (@{$input->{"body"}}) {
    push(@output, CLI::Git::bodystring($line));
}

foreach my $line (@{$input->{"content"}}) {
    push(@output, $line);
}

CLI::run($pager, { "input" => \@output });
