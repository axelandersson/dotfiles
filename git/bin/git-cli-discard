#!/usr/bin/env perl

use strict;
use CLI;
use CLI::Git;

my $options = CLI::options("all", "committed", "untracked");
my @files = @ARGV;

CLI::usage("[--all|--committed|--untracked|<file> ...]") if $options->{"help"} || (@files == 0 && !$options->{"all"} && !$options->{"committed"} && !$options->{"untracked"}) || (@files != 0 && ($options->{"all"} || $options->{"committed"} || $options->{"untracked"}));

if($options->{"all"}) {
    CLI::run(["git", "reset", "--hard"]);
} elsif($options->{"committed"}) {
    CLI::run(["git", "reset", "--hard", CLI::Git::remotebranch()]);
} elsif($options->{"untracked"}) {
    CLI::run(["git", "reset", "--hard"]);
    CLI::run(["git", "clean", "-f"]);
    CLI::run(["git", "submodule", "update", "--init", "--recursive"]);
} else {
    foreach my $file (@files) {
        CLI::run(["git", "reset", "--quiet", $file], { "assertonerror" => 1 });
        CLI::run(["git", "checkout", "--", $file], { "assertonerror" => 0 });
        CLI::run(["git", "clean", "-d", "--force", "--quiet", $file], { "assertonerror" => 0 });
    }
}
