#!/usr/bin/perl -w

use strict;
use CLI;

my $options = CLI::options("ignore-case|i");
my $pattern = shift @ARGV;
my @files = @ARGV ? @ARGV : ("-");
my $flags = $options->{"ignore-case"} ? "i" : "";

CLI::usage("[--ignore-case|-i] [<file> ...]") if $options->{"help"} || !$pattern;

foreach my $file (@files) {
    if($file eq "-") {
        while(my $line = <>) {
            println replaceline($line, $pattern, $flags);
        }
    } else {
        CLI::assert_true(open(FH, $file), $!);

        my @lines = <FH>;

        close(FH);

        CLI::assert_true(open(FH, ">$file"), $!);

        foreach my $line (@lines) {
            println replaceline($line, $pattern, $flags);
        }

        close(FH);
    }
}



sub replaceline {
    my $line = shift;
    my $pattern = shift;
    my $flags = shift;

    my $newline = $line;

    chomp($newline);
    eval("\$newline =~ $pattern$flags;");

    return $newline;
}
